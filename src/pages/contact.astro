---
import Layout from "../layouts/layout.astro";
---

<Layout title="Confidentialit√©">
    <!-- Conteneur principal -->
    <div class="max-w-[900px] mx-auto px-4">
      <div class="text-center">
        <!-- Avatar en cercle -->
        <div class="flex mt-12 justify-center mx-auto mb-6">
          <div
            class="rounded-full border-4 border-gray-200 w-32 h-32 flex items-center justify-center"
          >
            <img
              src="img/kw.webp"
              alt="ma photo"
              class="rounded-full w-full h-auto"
            />
          </div>
        </div>

        <!-- mon contact -->
        <div>
          <h2 class="text-xl mb-2">Nous contacter</h2>
            <p class="mb-4">
              <button 
                type="button" 
                popovertarget="contactDPO" 
                class="hover:text-heading transition-colors font-medium cursor-pointer"
              >
                contact@esportify.com
              </button>
            </p>
            <div class="mb-4">
              <a
                href="tel:+33612345678"
                class="hover:text-heading transition-colors font-medium"
              >
                +33 6 12 34 56 78
              </a>
            </div>
        </div>
      </div>

      <!--Politique de confidentialit√©-->
      <section class="my-6 p-6 bg-[#161215] rounded-lg">
        <h3 class="text-2xl mb-6 font-medium text-heading">Politique de confidentialit√©</h3>
        
        <div class="space-y-6 text-sm">
          <div>
            <h4 class="text-lg mb-2 font-medium">Introduction</h4>
            <p>
              Chez Esportify, nous prenons votre vie priv√©e au s√©rieux. Cette politique explique simplement quelles informations nous collectons, 
              comment nous les utilisons et comment nous les prot√©geons.
            </p>
          </div>

          <div>
            <h4 class="text-lg mb-2 font-medium">Donn√©es collect√©es</h4>
            <p>
              Nous collectons uniquement les donn√©es n√©cessaires √† votre utilisation du service :
            </p>
            <ul class="list-disc list-inside space-y-1 mt-2 ml-4">
              <li>Votre nom d'utilisateur et votre adresse email lors de l'inscription</li>
              <li>Votre mot de passe (toujours stock√© de mani√®re s√©curis√©e)</li>
              <li>Les √©v√©nements que vous cr√©ez (si vous √™tes organisateur)</li>
              <li>Les √©v√©nements que vous ajoutez en favoris</li>
              <li>Votre r√¥le sur la plateforme (visiteur, joueur, organisateur ou administrateur)</li>
            </ul>
          </div>

          <div>
            <h4 class="text-lg mb-2 font-medium">Utilisation de vos donn√©es</h4>
            <p>Vos donn√©es sont utilis√©es exclusivement pour :</p>
            <ul class="list-disc list-inside space-y-1 mt-2 ml-4">
              <li>Cr√©er et g√©rer votre compte utilisateur</li>
              <li>Vous permettre de cr√©er et de participer aux √©v√©nements</li>
              <li>Vous identifier lors de vos connexions</li>
              <li>Afficher les √©v√©nements que vous avez mis en favoris</li>
              <li>Vous permettre de g√©rer vos propres √©v√©nements (si vous √™tes organisateur)</li>
            </ul>
          </div>

          <div>
            <h4 class="text-lg mb-2 font-medium">Protection de vos donn√©es</h4>
            <p>Votre s√©curit√© est notre priorit√©. Voici les mesures que nous prenons :</p>
            <ul class="list-disc list-inside space-y-1 mt-2 ml-4">
              <li>Utilisation de jetons JWT (JSON Web Tokens) pour stocker votre identifiant et votre r√¥le</li>
              <li>Deux options de stockage √† votre choix :
                <ul class="list-disc list-inside ml-4 mt-1">
                  <li><strong>Session temporaire</strong> : Informations conserv√©es pendant la dur√©e de votre session</li>
                  <li><strong>Se souvenir de moi</strong> : Informations conserv√©es pour vos prochaines connexions</li>
                </ul>
              </li>
              <li>Suppression s√©curis√©e de votre jeton lors de la d√©connexion</li>
              <li>Cryptage de votre mot de passe avant stockage dans notre base de donn√©es</li>
            </ul>
          </div>

          <div>
            <h4 class="text-lg mb-2 font-medium">Partage des donn√©es</h4>
            <p>Notre approche concernant vos donn√©es :</p>
            <ul class="list-disc list-inside space-y-1 mt-2 ml-4">
              <li>Nous ne vendons pas vos donn√©es personnelles</li>
              <li>Nous ne partageons pas vos informations avec des tiers</li>
              <li>Nous ne collectons pas plus d'informations que n√©cessaire</li>
              <li>Certaines informations publiques comme votre nom d'utilisateur sont visibles pour les autres utilisateurs</li>
              <li>Si vous √™tes organisateur, votre nom sera affich√© comme cr√©ateur de vos √©v√©nements</li>
            </ul>
          </div>

          <div>
            <h4 class="text-lg mb-2 font-medium">Vos droits RGPD</h4>
            <p>Conform√©ment au R√®glement G√©n√©ral sur la Protection des Donn√©es (RGPD), vous disposez des droits suivants :</p>
            <ul class="list-disc list-inside space-y-1 mt-2 ml-4">
              <li>Droit d'acc√®s √† vos donn√©es personnelles</li>
              <li>Droit de rectification et de mise √† jour de vos donn√©es</li>
              <li>Droit √† l'effacement (droit √† l'oubli)</li>
              <li>Droit d'opposition au traitement de vos donn√©es</li>
              <li>Droit √† la portabilit√© de vos donn√©es</li>
            </ul>
            <p class="mt-2">
              Pour exercer ces droits ou pour toute question concernant vos donn√©es personnelles,
              <button 
                type="button" 
                popovertarget="contactDPO" 
                class="text-red-600 hover:text-heading transition-colors cursor-pointer"
              >
                contactez-nous
              </button>.
            </p>
          </div>

          <div>
            <h4 class="text-lg mb-2 font-medium">Dur√©e de conservation</h4>
            <p>Vos donn√©es sont conserv√©es :</p>
            <ul class="list-disc list-inside space-y-1 mt-2 ml-4">
              <li>Token JWT dans sessionStorage : jusqu'√† la fermeture de l'onglet ou du navigateur</li>
              <li>Token JWT dans localStorage : jusqu'√† la d√©connexion explicite ou suppression des donn√©es de navigation</li>
              <li>Donn√©es de compte : tant que votre compte reste actif (possibilit√© de suppression sur demande)</li>
            </ul>
          </div>

          <div class="mt-8 text-center text-xs">
            <p>Cette politique a √©t√© mise √† jour le 5 avril 2025.</p>
          </div>
        </div>
      </section>
    </div>

    <!-- Popup de formulaire de contact -->
    <div 
      class="rounded resize max-w-[900px] border border-popupEvent overflow-y-auto" 
      id="contactDPO" 
      popover
    >
      <div class="flex justify-between bg-popupEvent">
        <h2 class="text-left flex-1 pl-2 cursor-move select-none py-1">
          üîí Contact
        </h2>
        <button class="text-xl px-2 select-none" popovertarget="contactDPO">
          X
        </button>
      </div>

      <form 
        id="formContact" 
        class="inset-0 w-full rounded max-w-[900px] mx-auto items-center justify-center z-50 px-5 py-2 transition-opacity"
        action="https://api.web3forms.com/submit" 
        method="POST"
        x-data="{ 
          formStatus: '',
          formMessage: '',
          submitForm(event) {
            event.preventDefault();
            this.formStatus = 'sending';

            const form = document.getElementById('formContact');
            const formData = new FormData(form);
            
            fetch(form.action, {
              method: 'POST',
              body: formData
            })
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                this.formStatus = 'success';
                this.formMessage = 'Message envoy√© avec succ√®s ! Nous vous r√©pondrons dans les plus brefs d√©lais.';
                form.reset();
                setTimeout(() => {
                  document.getElementById('contactDPO').hidePopover();
                  this.formStatus = '';
                }, 3000);
              } else {
                this.formStatus = 'error';
                this.formMessage = 'Une erreur est survenue. Veuillez r√©essayer.';
              }
            })
            .catch(error => {
              this.formStatus = 'error';
              this.formMessage = 'Une erreur est survenue. Veuillez r√©essayer.';
              console.error('Erreur:', error);
            });
          }
        }"
        @submit="submitForm"
      >
        <!-- Web3Forms Access Key - Remplacez par votre cl√© d'API -->
        <input type="hidden" name="access_key" value="2dcc3f1b-036f-48a7-987a-cdada0d05ae5">
        
        <!-- Sujet du message -->
        <input type="hidden" name="subject" value="Demande RGPD - Esportify">

        <!-- Message de statut du formulaire -->
        <div 
          x-show="formStatus !== ''" 
          x-transition 
          class="mb-4 p-3 rounded text-sm" 
          :class="formStatus === 'success' ? 'bg-green-600 bg-opacity-25' : 'bg-red-600 bg-opacity-25'"
        >
          <p x-text="formMessage"></p>
        </div>

        <!-- Conteneur flex pour nom et email -->
        <div class="flex flex-col md:flex-row gap-4 mb-4">
          <!-- Nom -->
          <div class="flex-1">
            <label for="name" class="block mb-1 text-sm font-medium">Nom</label>
            <input
              type="text"
              id="name"
              name="name"
              required
              class="bg-[#161215] text-text w-full border border-[#4d2d45] rounded px-3 py-2"
              placeholder="Votre nom"
            />
          </div>

          <!-- Email -->
          <div class="flex-1">
            <label for="email" class="block mb-1 text-sm font-medium">Email</label>
            <input
              type="email"
              id="email"
              name="email"
              required
              class="bg-[#161215] text-text w-full border border-[#4d2d45] rounded px-3 py-2"
              placeholder="votre@email.com"
            />
          </div>
        </div>

        <!-- Message -->
        <div>
          <label for="message" class="block mb-1 text-sm font-medium">Message</label>
          <textarea
            id="message"
            name="message"
            required
            rows="8"
            class="bg-[#161215] text-text w-full border border-[#4d2d45] flex-1 rounded px-3 py-2 min-h-40 min-w-72"
            placeholder="Votre message concernant vos donn√©es personnelles..."
          ></textarea>
        </div>

        <!-- Honeypot pour √©viter le spam -->
        <input type="checkbox" name="botcheck" class="hidden" style="display: none;">

        <!-- Bouton d'envoi -->
        <div>
          <button
            type="submit"
            class="w-full bg-popupEvent hover:bg-[#532447] text-white px-4 py-2 mt-5 mb-3 rounded transition-colors"
            :disabled="formStatus === 'sending'"
          >
            <span x-show="formStatus !== 'sending'">Envoyer la demande</span>
            <span x-show="formStatus === 'sending'">Envoi en cours...</span>
          </button>
        </div>
      </form>
    </div>
</Layout>

<script>
  const popupMovable = document.getElementById("contactDPO") as HTMLElement;
  const header = popupMovable.querySelector("h2") as HTMLElement;
  let isDragging = false;
  let startX = 0;
  let startY = 0;
  let offsetX = 0,
    offsetY = 0;

  header.addEventListener("mousedown", (e) => {
    isDragging = true;
    startX = e.clientX - offsetX;
    startY = e.clientY - offsetY;
    popupMovable.classList.add("grabbing");
  });

  document.addEventListener("mousemove", (e) => {
    if (isDragging) {
      offsetX = e.clientX - startX;
      offsetY = e.clientY - startY;

      // Obtenir les dimensions du popup
      const rect = popupMovable.getBoundingClientRect();
      
      // Utilisation de `transform` pour un d√©placement fluide
      popupMovable.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
    }
  });

  document.addEventListener("mouseup", () => {
    isDragging = false;
    popupMovable.classList.remove("grabbing");
  });
</script>

<style>
  #contactDPO {
    @apply bg-[#5e3554] text-text;
    opacity: 0;
    transition:
      display 0.3s,
      opacity 0.3s;
    transition-behavior: allow-discrete;
    &:popover-open {
      display: block;
      opacity: 1;
      @starting-style {
        opacity: 0;
      }
    }
  }
  
  #formContact {
    background: linear-gradient(to bottom, #251e23, #121012);
  }
  
  input,
  textarea {
    border: 1px solid #4d2d45;
  }
  
  .grabbing {
    cursor: grabbing;
  }
</style>